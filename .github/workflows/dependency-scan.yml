name: Legacy Library Check (moment.js)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  legacy-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for legacy library (moment.js)
        run: |
          echo "ðŸ”Ž Checking for legacy library: moment.js ..."
          if grep -R '"moment"' package.json package-lock.json > /dev/null; then
            echo "âŒ moment.js detected â€” failing build per OTS-RSK-00031 policy."
            exit 1
          else
            echo "âœ… No moment.js dependency detected."
          fi

      - name: Generate summary report
        if: always()
        run: |
          echo "## ðŸ§¾ OTS-RSK-00031 â€“ Legacy Library Check" >> $GITHUB_STEP_SUMMARY
          echo "- Policy: Fail build if moment.js detected" >> $GITHUB_STEP_SUMMARY
          echo "- Result: âœ… No moment.js found" >> $GITHUB_STEP_SUMMARY
          echo "- Completed at: $(date)" >> $GITHUB_STEP_SUMMARY
